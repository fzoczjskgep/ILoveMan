<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poste Italiane Genova</title>
</head>

<body>
    <!-- Login Section -->
    <div class="container" id="login-container">
        <h1>Connexion</h1>
        <div class="login-box">
            <input type="text" id="username" class="form-input" placeholder="ID">
            <br>
            <input type="password" id="password" class="form-input" placeholder="Mot de passe">
            <br>
            <button class="btn" onclick="login()">Se connecter</button>
            <br>
            <button class="btn" onclick="showRecovery()">Mot de passe oubli√©</button>
            <br>
            <br>
            <img src="PosteItaliane.png" width="40%">
        </div>
    </div>

    <!-- Recovery Section -->
    <div class="container hidden" id="recovery-container">
        <h1>R√©cup√©ration de mot de passe</h1>
        <p>R√©pondez aux questions de r√©cup√©ration pour vous reconnecter.</p>
        <input type="text" id="ID" class="form-input" placeholder="Votre ID">
        <br>
        <input type="text" id="pet" class="form-input" placeholder="Nom de votre animal de compagnie">
        <br>
        <input type="text" id="grandmother" class="form-input" placeholder="Pr√©nom de votre grand-m√®re">
        <br>
        <input type="text" id="city" class="form-input" placeholder="Lieu o√π vous habitez">
        <br>
        <button class="btn" onclick="back()">Retour</button>
        <button class="btn" onclick="recoverAccount()">Valider</button>
    </div>

    <!-- Home Section -->
    <div class="container hidden" id="home">
        <h2 class="section-title">Gestion des exp√©ditions</h2>
        <p>Bienvenue Albano.</p>
        <br>
        <p>Indiquer le code du dossier pour planifier un itin√©raire.</p>
        <br>
        <input type="text" id="dossier" class="form-input" placeholder="Code du dossier">
        <br>
        <button class="btn" onclick="validateFolder()">Confirmer</button>
    </div>

    <div class="container hidden" id="game">
        <h2 class="section-title">Gestion des exp√©ditions</h2>
        <p>Bienvenue Albano.</p>
        <br>
        <p>Une lettre √† destination de <b>Manon Vallat</b> est en cours d'acheminement. Le courrier doit arriver au d√©pot [Berlin], le temps de trajet depuis [Genoa] est estim√© √† 10h37.</p>
        <br>
        <p>Merci d'indiquer un itin√©raire pour le chauffeur. Attention, afin d'optimiser la logistique, veillez √† ce que le transporteur ne passe pas deux fois par le m√™me endroit, et qu'il effectue une boucle pour revenir √† [Genoa] ensuite. Pour vous aider, √† distribuer l'ensemble du courrier, des indications ont √©t√© ajout√©es sur la carte ci-apr√®s. Veillez √† ce que le transporteur passe le nombre de fois indiqu√© pour chaque zone g√©ographique. Lorsque rien n'est pr√©cis√©, vous √™tes libres d'organiser le trajet comme vous le souhaitez.
        </p>
        <br>
        <canvas id="gameCanvas"></canvas>
        <br>
        <button class="btn" onclick="validateSolution()">Valider</button>
        <p id="result"></p>
    </div>

    <div class="container hidden" id="lettre">
        <h2>Courrier pour Manon ü•∞</h2>
        <p>Coucou ! Bien jou√© si tu es arriv√©e jusque l√† c'est que tu as r√©solu le petit casse-t√™te que je t'ai pr√©par√© !! J'esp√®re que √ßa t'as plu et que c'√©tait ni trop dur ni trop facile...</p>
        <br>

        <p>C'est un peu moins mignon de t'√©crire une lettre sur un ordinateur qu'avec un vrai papier mais j'arrive bient√¥t √† Berlin pour rattraper √ßa !</p>

        <p>Tu me manques un petit peu tous les jours mais j'aime bien notre petit relation √† distance √ßa marche super bien et √ßa va √™tre encore plus chouette quand on va se retrouver ‚ò∫Ô∏è</p>

        <p>J'esp√®re que les quelques mois qu'il reste de stage vont passer super vite pour qu'on puisse partir en vacances tous les deux au Soleil cet √©t√© ! Ton stage a l'air super sympa et Berlin est hyper styl√©e c'est super que tu sois l√†-bas !</p>

        <p>Je t'aime FORT FORT FORT ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è Plein de bisous de tr√®s loin !!</p>
        <br>
        <p>√Ä tr√®s bient√¥t Man ü•∞</p>
        <br>
        <br>
        <p>Ant</p>
        <br>
        <br>
        <p>PS : J'ai essay√© d'√©viter un max les "je" aussi mais c'est pas facile... j'suis aussi trop une personne toxique !</p>

    </div>

    <script>
        function back() {
            document.getElementById("login-container").classList.remove("hidden");
            document.getElementById("recovery-container").classList.add("hidden");
        }


        function login() {
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            
            if (username === "ab256goa18" && password === "bfezifzoefzebgopojzg487g7r45r5r44rgr!!fzfz@¬±fjefije") {
                document.getElementById("login-container").classList.add("hidden");
                document.getElementById("home").classList.remove("hidden");
            } else {
                alert("Identifiants incorrects. R√©essayez !");
            }
        }

        function validateFolder() {
            var folder = document.getElementById("dossier").value;

            if (folder === "45862024") {
                document.getElementById("game").classList.remove("hidden");
                document.getElementById("home").classList.add("hidden")
            } else {
                alert("Identifiants incorrects. R√©essayez !");
            }
        }

        function showRecovery() {
            document.getElementById("login-container").classList.add("hidden");
            document.getElementById("recovery-container").classList.remove("hidden");
        }

        function recoverAccount() {
            var ID = document.getElementById("ID").value.toLowerCase();
            var pet = document.getElementById("pet").value.toLowerCase();
            var grandmother = document.getElementById("grandmother").value.toLowerCase();
            var city = document.getElementById("city").value.toLowerCase();
            
            if (ID === "ab256goa18" && pet === "fluffy" && grandmother === "clotilde" && city === "genoa" || city === "genova" || city === "g√™nes") {
                alert("R√©ponses correctes ! Connexion r√©ussie.");
                document.getElementById("recovery-container").classList.add("hidden");
                document.getElementById("home").classList.remove("hidden");
            } else {
                alert("R√©ponses incorrectes. R√©essayez !");
            }
        }

        function trackPackage() {
            var trackingNumber = document.getElementById('tracking-number').value;
            // Logique de suivi du colis (simul√© ici)
            if (trackingNumber) {
                document.getElementById('tracking-result').innerHTML = `Le colis avec le num√©ro ${trackingNumber} est en transit.`;
            } else {
                alert('Veuillez entrer un num√©ro de suivi.');
            }
        }

        const pieces = document.querySelectorAll('.piece');
        const mapZones = document.querySelectorAll('.map-zone');

        let placedPieces = 0;

        pieces.forEach(piece => {
            piece.addEventListener('dragstart', dragStart);
        });

        mapZones.forEach(zone => {
            zone.addEventListener('dragover', dragOver);
            zone.addEventListener('drop', dropPiece);
        });

        function dragStart(event) {
            event.dataTransfer.setData("text", event.target.dataset.region);
            event.target.classList.add("hidden");
        }

        function dragOver(event) {
            event.preventDefault();
        }

        function dropPiece(event) {
            event.preventDefault();
            const region = event.dataTransfer.getData("text");

            if (event.target.dataset.region === region) {
                event.target.innerText = region;
                event.target.style.backgroundColor = "#4CAF50";
                placedPieces++;
            } else {
                document.querySelector(`.piece[data-region="${region}"]`).classList.remove("hidden");
            }

            if (placedPieces === 4) {
                document.getElementById("message").style.display = "block";
            }
        }

        // Game

        const size = 15;
        const cellSize = 40;
        const canvas = document.getElementById("gameCanvas");
        canvas.width = size * cellSize;
        canvas.height = size * cellSize;
        const ctx = canvas.getContext("2d");

        let grid = [
            ["", "", 3, 2, 2, "", 2, 2, 2, "", "", "", "", 3, ""],
            [2, 1, "", "", "", "", "", 1, 1, "", "", 3, "", 1, ""],
            ["", 1, 2, "", "", 3, "", "", "", "", 2, "", "", 2, ""],
            [1, "", 1, "", 2, "", 3, "", 1, 2, "", "", "", 3, ""],
            ["", "", "", "", "", "", "", 1, 2, "", 3, 1, 2, "", ""],
            [3, 0, "", 3, "", 3, 3, "", "", "", 2, "", 1, "", ""],
            ["", "", "", "", 1, "", "", 1, "", "", 1, "", 2, 0, 1],
            [3, "", "", "", 1, "", "", "", "", 3, 3, "", "", "", ""],
            ["", 1, 2, "", "", "", "", 0, 0, "", "", "", 1, "", 3],
            [3, 2, 1, 2, "", 0, 2, "", "", "", 2, 2, "", "", ""],
            ["", 2, "", "", "", "", "", "", 1, "", "", "", 0, 2, 1],
            [2, "", "", "", 1, "", 2, "", 2, "", "", "", 2, 3, ""],
            ["", "", "", 1, "", "", 1, 1, "", "", 2, "", "", "", ""],
            [2, 0, "", 3, 2, "", 2, "", "", "", "", 3, "", 3, 3],
            ["", 2, "", 3, "", "", "", "", 0, 1, 1, 1, "", "", ""]
        ];

        let edges = {};

        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "black";
            ctx.font = "20px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    let num = grid[y][x];
                    ctx.fillText(num, x * cellSize + cellSize / 2, y * cellSize + cellSize / 2);
                }
            }
            drawEdges();
        }

        function drawEdges() {
            ctx.strokeStyle = "blue";
            ctx.lineWidth = 3;
            for (let key in edges) {
                let [x1, y1, x2, y2] = key.split(",").map(Number);
                ctx.beginPath();
                ctx.moveTo(x1 * cellSize, y1 * cellSize);
                ctx.lineTo(x2 * cellSize, y2 * cellSize);
                ctx.stroke();
            }
        }

        canvas.addEventListener("click", function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((event.clientX - rect.left) / cellSize);
            const y = Math.floor((event.clientY - rect.top) / cellSize);
            const dx = (event.clientX - rect.left) % cellSize;
            const dy = (event.clientY - rect.top) % cellSize;

            let key;
            if (dx < dy && dx < cellSize - dy) {
                key = `${x},${y},${x},${y+1}`;
            } else if (dx > dy && dx > cellSize - dy) {
                key = `${x+1},${y},${x+1},${y+1}`;
            } else if (dy < dx && dy < cellSize - dx) {
                key = `${x},${y},${x+1},${y}`;
            } else {
                key = `${x},${y+1},${x+1},${y+1}`;
            }
            
            if (edges[key]) delete edges[key];
            else edges[key] = true;
            
            drawGrid();
        });

        function validateSolution() {
            let isValid = true;

            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    let expectedEdges = grid[y][x];
                    if (expectedEdges === "") continue;

                    let actualEdges = [
                        `${x},${y},${x+1},${y}`,
                        `${x},${y},${x},${y+1}`,
                        `${x+1},${y},${x+1},${y+1}`,
                        `${x},${y+1},${x+1},${y+1}`
                    ].filter(edge => edges[edge]).length;

                    if (expectedEdges != actualEdges) {
                        document.getElementById("result").innerText = "Solution incorrecte ‚ùå";
                        return;
                    }
                }
            }

            function isSingleLoop() {
                if (Object.keys(edges).length === 0) return false;

                let visitedEdges = new Set();
                let nodes = {};
                let startNode = null;

                for (let edge of Object.keys(edges)) {
                    let [x1, y1, x2, y2] = edge.split(",").map(Number);
                    let nodeA = `${x1},${y1}`;
                    let nodeB = `${x2},${y2}`;

                    if (!nodes[nodeA]) nodes[nodeA] = [];
                    if (!nodes[nodeB]) nodes[nodeB] = [];

                    nodes[nodeA].push(nodeB);
                    nodes[nodeB].push(nodeA);

                    startNode = nodeA;
                }

                for (let node in nodes) {
                    if (nodes[node].length !== 2) return false;
                }

                let visitedNodes = new Set();
                let currentNode = startNode;
                let previousNode = null;

                visitedNodes.add(currentNode);
                let nextNodes = nodes[currentNode].filter(n => n !== previousNode);
                previousNode = currentNode;
                currentNode = nextNodes[0];

                while (true) {
                    visitedNodes.add(currentNode);
                    let nextNodes = nodes[currentNode].filter(n => n !== previousNode);

                    console.log(currentNode)
                    console.log(nextNodes)
                    console.log("====")

                    if (nextNodes.length !== 1) return false;

                    previousNode = currentNode;
                    currentNode = nextNodes[0];

                    if (currentNode === startNode) break;
                }

                return visitedNodes.size === Object.keys(nodes).length;
            }

            if (!isSingleLoop()) {
                isValid = false;
            }

            document.getElementById("result").innerText = isValid ? "Trajet correct ! ‚úÖ" : "Trajet incorrect ‚ùå";

            if (isValid === true) {
                alert("F√©licitations, le trajet est correctement planifi√© ! La destinataire a bien re√ßu sa lettre !")
                document.getElementById("game").classList.add("hidden")
                document.getElementById("lettre").classList.remove("hidden")
            }
        }

        drawGrid();

    </script>

</body>
</html>
